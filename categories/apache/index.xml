<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Apache on ROBO LOG</title>
    <link>http://blog.syundo.org/categories/apache/</link>
    <description>Recent content in Apache on ROBO LOG</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>ja</language>
    <lastBuildDate>Sun, 12 Apr 2015 23:19:51 +0900</lastBuildDate>
    <atom:link href="http://blog.syundo.org/categories/apache/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>WordpressをロリポップからDigital Oceanに移した</title>
      <link>http://blog.syundo.org/post/1072/</link>
      <pubDate>Sun, 12 Apr 2015 23:19:51 +0900</pubDate>
      
      <guid>http://blog.syundo.org/post/1072/</guid>
      <description>&lt;p&gt;今までHPとブログに使っていたロリポップのレンタルサーバをやめて，DigitalOceanの最安プランを使うことにした．VPSを借りてWEBアプリ作れるようになりたかったからである．それにともなってブログとHPのサーバを移行する作業が必要だった．&lt;/p&gt;

&lt;p&gt;そこで新しいサーバでWordpressを使えるようにして以前のサーバから移行するまでの手順をメモしておく．&lt;/p&gt;

&lt;p&gt;まずはDigitalOceanに登録してDropletを作成する必要がある．今回は
512MB Ram 20GB SSD Disk Singapore 1 CentOS 6.5 x64
のものを作った．1時間1円くらいのプランだから月に500円くらいになる．案内に沿ってボタンを押すだけなので簡単だ．セットアップの途中にSSHの設定項目があるので，先に以下のSSHの設定をしておくとスムーズで良い．&lt;/p&gt;

&lt;h2&gt;SSHの鍵の登録&lt;/h2&gt;
DigitalOceanのマイページから仮想コンソールを使ってマシンにアクセスすることもできるが，反応が緩慢なのでSSH接続したほうが色々と捗る．
```bash
ssh-keygen
```
で公開鍵ができるので中身をコピペしてDropletの生成時に登録しておく．生成時にしていなかった場合は，YourSetting-&amp;gt;Securityより設定しておく．

&lt;h2&gt;Apache 導入&lt;/h2&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #e7e9db&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;span&gt;&lt;/span&gt;yum install -y httpd httpd-devel
chkconfig httpd on
service httpd start
&lt;/pre&gt;&lt;/div&gt;

&lt;h2&gt;PHP 導入&lt;/h2&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #e7e9db&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;span&gt;&lt;/span&gt;rpm -Uvh http://dl.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm
rpm -Uvh http://rpms.famillecollet.com/enterprise/remi-release-6.rpm
yum --enablerepo&lt;span style=&#34;color: #5bc4bf&#34;&gt;=&lt;/span&gt;remi,remi-php55 install php php-devel php-mysql php-mbstring php-gd
&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #e7e9db&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;span&gt;&lt;/span&gt;vi /etc/php.ini
vi /etc/httpd/conf.d/php.conf
&lt;/pre&gt;&lt;/div&gt;

&lt;h2&gt;MySQL 導入&lt;/h2&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #e7e9db&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;span&gt;&lt;/span&gt;yum install mysql-community-release-el6-5.noarch.rpm
yum install -y mysql-community-client mysql-community-devel mysql-community-server
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Digital Oceanの最安プランではメモリが不足がちらしい．スワップファイルを作る．&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #e7e9db&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;span&gt;&lt;/span&gt;sudo dd &lt;span style=&#34;color: #815ba4&#34;&gt;if&lt;/span&gt;&lt;span style=&#34;color: #5bc4bf&#34;&gt;=&lt;/span&gt;/dev/zero &lt;span style=&#34;color: #ef6155&#34;&gt;of&lt;/span&gt;&lt;span style=&#34;color: #5bc4bf&#34;&gt;=&lt;/span&gt;/swapfile &lt;span style=&#34;color: #ef6155&#34;&gt;bs&lt;/span&gt;&lt;span style=&#34;color: #5bc4bf&#34;&gt;=&lt;/span&gt;1M &lt;span style=&#34;color: #ef6155&#34;&gt;count&lt;/span&gt;&lt;span style=&#34;color: #5bc4bf&#34;&gt;=&lt;/span&gt;1024
mkswap /swapfile
swapon /swapfile
sudo sh -c &lt;span style=&#34;color: #48b685&#34;&gt;&amp;quot;echo &amp;#39;/swapfile swap swap defaults 0 0&amp;#39; &amp;amp;gt;&amp;amp;gt; /etc/fstab&amp;quot;&lt;/span&gt;
chkconfig mysqld on
service mysqld start
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;MySQLの設定とかする．全部Yesと答える．ただしパスワードは空欄にしておいた．&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #e7e9db&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;span&gt;&lt;/span&gt;mysql_secure_installation
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;h2&gt;ムームードメインで取得したドメインを管理&lt;/h2&gt;
ムームードメインのメニューのネームサーバー設定変更より
&lt;a href=&#34;http://blog.syundo.org/images/2015/04/name_server.png&#34;&gt;&lt;img class=&#34;alignnone size-full wp-image-1079&#34; src=&#34;http://blog.syundo.org/images/2015/04/name_server.png&#34; alt=&#34;name_server&#34;   /&gt;
&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;こんな感じにする．&lt;/p&gt;

&lt;p&gt;ブログにはサブドメイン.blogを使っているのでその設定をする必要がある．
Digital OceanのDNS設定メニューより，
&lt;a href=&#34;http://blog.syundo.org/images/2015/04/DO_domain.png&#34;&gt;&lt;img class=&#34;alignnone size-full wp-image-1078&#34; src=&#34;http://blog.syundo.org/images/2015/04/DO_domain.png&#34; alt=&#34;DO_domain&#34;   /&gt;&lt;/a&gt;
Aレコードにサブドメインを追加する．あとはApache側の設定が要る．&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #e7e9db&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;span&gt;&lt;/span&gt;vim /etc/httpd/conf/httpd.conf
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;以下の部分を編集してポート指定．&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #e7e9db&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;span&gt;&lt;/span&gt;NameVirtualHost *:80
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;あとは末尾に以下を追加してドメインごとのルートディレクトリを設定する．&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #e7e9db&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;span&gt;&lt;/span&gt;&amp;lt;VirtualHost *:80&amp;gt;
    ServerName syundo.org
    DocumentRoot /var/www/html/
  &amp;lt;Directory /var/www/html/&amp;gt;
    AllowOverride All
    Options FollowSymLinks
    Order allow,deny
    Allow from all
   &amp;lt;/Directory&amp;gt;
&amp;lt;/VirtualHost&amp;gt;
&amp;lt;VirtualHost *:80&amp;gt;
    ServerName blog.syundo.org
    DocumentRoot /var/www/html/blog/
  &amp;lt;Directory /var/www/html/blog/&amp;gt;
    AllowOverride All
    Options FollowSymLinks
    Order allow,deny
    Allow from all
   &amp;lt;/Directory&amp;gt;
&amp;lt;/VirtualHost&amp;gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;h2&gt;PHPmyadmin導入&lt;/h2&gt;
Wordpressの移行作業にPHPmyadminを使っている事例がほとんどだったのでそれに習って作業した．&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #e7e9db&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;span&gt;&lt;/span&gt;yum -y install --enablerepo&lt;span style=&#34;color: #5bc4bf&#34;&gt;=&lt;/span&gt;remi ImageMagick-last
yum -y install --enablerepo&lt;span style=&#34;color: #5bc4bf&#34;&gt;=&lt;/span&gt;remi-php55 phpMyAdmin
&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #e7e9db&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;span&gt;&lt;/span&gt;vim /etc/httpd/conf.d/phpMyAdmin.conf
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;を編集．内容は忘れた．&lt;/p&gt;

&lt;p&gt;&lt;h2&gt;データの移行&lt;/h2&gt;
MySQLで作業する．ログインしてパスワード設定する．&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #e7e9db&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;span&gt;&lt;/span&gt;mysql -u root
&lt;span style=&#34;color: #2f1e2e&#34;&gt;set&lt;/span&gt; password &lt;span style=&#34;color: #815ba4&#34;&gt;for&lt;/span&gt; root@localhost&lt;span style=&#34;color: #5bc4bf&#34;&gt;=&lt;/span&gt;password&lt;span style=&#34;color: #5bc4bf&#34;&gt;(&lt;/span&gt;&lt;span style=&#34;color: #48b685&#34;&gt;&amp;#39;hogehoge&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #5bc4bf&#34;&gt;)&lt;/span&gt;&lt;span style=&#34;color: #2f1e2e&#34;&gt;;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;データベース作る．&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #e7e9db&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;span&gt;&lt;/span&gt;create database database_name
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;作業ユーザを作っておく&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #e7e9db&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;span&gt;&lt;/span&gt;grant all on database_name.* to dbuser@localhost identified by &lt;span style=&#34;color: #48b685&#34;&gt;&amp;#39;piyopiyo&amp;#39;&lt;/span&gt;&lt;span style=&#34;color: #2f1e2e&#34;&gt;;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;以前のブログのデータベースの移行はPHPmyadimnを使って行う．これはググれば色んなサイトで解説されている．どれが正しいのかはいまいちわからなかった．&lt;a href=&#34;http://websae.net/wordpress-backup-without-plugin-20140924/&#34;&gt;http://websae.net/wordpress-backup-without-plugin-20140924/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;worldpressに使うデータベース名，作業ユーザー，パスワードを設定する．&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #e7e9db&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;span&gt;&lt;/span&gt;vim wp-config.php
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;Wordpressファイルの所有者の変更をしておく．こうしないとプラグインの更新とかで不具合が出る．&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #e7e9db&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;span&gt;&lt;/span&gt;sudo chown -R apache:apache myblogdir
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;どのグループ，ユーザーに権限を与えればいいかは， /etc/httpd/conf/httpd.conf　にある，&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #e7e9db&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;span&gt;&lt;/span&gt;User apache
Group apache
&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;の部分を見ればわかる．&lt;/p&gt;

&lt;p&gt;&lt;h2&gt;追記：&lt;/h2&gt;
トップページからのリンクがすべて404となってしまった．
例えばカテゴリごとに飛ぼうとしてもエラーになる．&lt;/p&gt;

&lt;p&gt;ダッシュボードの 「設定 -&amp;gt; パーマリンク設定」　より，何も変更せずに 「保存」　を押すと正常な状態になった．&lt;/p&gt;

&lt;p&gt;&lt;h2&gt;参考：&lt;/h2&gt;
&lt;a href=&#34;http://nekopunch.hatenablog.com/entry/2014/03/22/020507&#34;&gt;http://nekopunch.hatenablog.com/entry/2014/03/22/020507&lt;/a&gt;
&lt;a href=&#34;http://wp.fsv.jp/guide/server-shift/&#34;&gt;http://wp.fsv.jp/guide/server-shift/&lt;/a&gt;
&lt;a href=&#34;http://websae.net/wordpress-backup-without-plugin-20140924/&#34;&gt;http://websae.net/wordpress-backup-without-plugin-20140924/&lt;/a&gt;
&lt;a href=&#34;http://javatechnology.net/service/apache-sub-domain/&#34;&gt;http://javatechnology.net/service/apache-sub-domain/&lt;/a&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>XAMPPのエイリアス設定</title>
      <link>http://blog.syundo.org/post/948/</link>
      <pubDate>Sun, 29 Dec 2013 15:49:55 +0900</pubDate>
      
      <guid>http://blog.syundo.org/post/948/</guid>
      <description>&lt;p&gt;C:/xampp/apache/conf/httpd.confに以下を追記．&lt;/p&gt;

&lt;p&gt;Apache2.4以降の場合は，「Require all granted」書かないとアクセス権くれない．&lt;/p&gt;
&lt;div class=&#34;highlight&#34; style=&#34;background: #e7e9db&#34;&gt;&lt;pre style=&#34;line-height: 125%&#34;&gt;&lt;span&gt;&lt;/span&gt;Alias /(エイリアス名)/ &amp;quot;(ディレクトリ)/&amp;quot;
    &lt;span style=&#34;color: #2f1e2e&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&#34;color: #5bc4bf&#34;&gt;Directory&lt;/span&gt; &lt;span style=&#34;color: #ef6155&#34;&gt;&amp;quot;(&lt;/span&gt;&lt;span style=&#34;color: #06b6ef&#34;&gt;ディレクトリ&lt;/span&gt;&lt;span style=&#34;color: #ef6155&#34;&gt;)&amp;quot;&lt;/span&gt;&lt;span style=&#34;color: #2f1e2e&#34;&gt;&amp;gt;&lt;/span&gt;
               Options Indexes FollowSymLinks Includes ExecCGI
               AllowOverride All
               Require all granted
               Order allow,deny
               Allow from all
    &lt;span style=&#34;color: #2f1e2e&#34;&gt;&amp;lt;/&lt;/span&gt;&lt;span style=&#34;color: #5bc4bf&#34;&gt;Directory&lt;/span&gt;&lt;span style=&#34;color: #2f1e2e&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
</description>
    </item>
    
  </channel>
</rss>